import * as _ from 'lamb';

import {getDefault, hasDefault} from 'types';

// params that startsWith('__') should be required, with no default
export const makeRequestToQuery = fieldName => _.pipe([
	_.collect([
		obj => _.has(obj, 'field') ? {field: fieldName} : {},
		_.pipe([_.pickIf(hasDefault), _.mapValuesWith(getDefault)])
	]),
	_.apply(_.merge)
]);

export const getCountQuery = (fields, searchTerm) => ({
	size: 0,
	aggs: {
		messages: {
			filters: {
				filters: _.fromPairs(fields.map(name => [name, {
					term: {
						[name]: searchTerm
					}
				}]))
			}
		}
	}
});
