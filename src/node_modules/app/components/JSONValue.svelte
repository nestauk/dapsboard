<script>
export let value;
export let editable = false;
export let parsedValue;

let json = '';
let editedJson = '';

function generateHTML(value) {
    const nodeType = typeof(value);
    switch (nodeType) {
        case 'boolean':
        case 'number':
            return value.toString();
        case 'string':
            return `"${value}"`;
        case 'object':
            if (value === null)
                return 'null';
            else if (Array.isArray(value)) {
                let propsHtml = value.map((v, i) => `<li><span class='property-value'>${generateHTML(v)}</span>${i<value.length-1 ? "<span class='boilerplate'>,</span>":""}</li>`);
                return `<span class='boilerplate'>[</span> <ul class='property-list'>${propsHtml.join('')}</ul> <span class='boilerplate'>]</span>`;
            }
            else {
                const keys = Object.keys(value);
                let propsHtml = keys.map((k, i) => `<li><span class='property-name'>"${k}"</span> <span class='boilerplate'>:</span> <span class='property-value'>${generateHTML(value[k])}</span>${i<keys.length-1 ? "<span class='boilerplate'>,</span>": ""}</li>`);
                return `<span class='boilerplate'>{</span> <ul class='property-list'>${propsHtml.join('')}</ul> <span class='boilerplate'>}</span>`;
            }
    }
}

function handleInput(event) {
    try {
        const text = event.target.textContent;
        if (editable && text !== '') 
            parsedValue = JSON.parse(text);
        else
            parsedValue = null;
    }
    catch (e) {
        parsedValue = null;
        console.log(e);
    }
}

$: json = generateHTML(parsedValue = value);
</script>

{#if editable == true}
    <pre contenteditable on:input={handleInput}>{@html json}</pre>
{:else}
    <pre>{@html json}</pre>
{/if}

<style>
pre {
    overflow: auto;
    width: 100%;
    height: 100%;
}
:global(.boilerplate) {
    color: #fC8;
}
:global(.property-list) {
    margin-left: 1em;
    list-style-type: none;
}
:global(.property-name) {
    font-weight: bold;
    color: #000;
}
:global(.property-value) {
    color: #00F;
}
</style>