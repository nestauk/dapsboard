<script>
	// eslint-disable-next-line node/no-unpublished-import
	import { createEventDispatcher } from 'svelte';

	const dispatch = createEventDispatcher();

	export let dataType;
	export let fieldEditor;
	export let value = [];
	export let currentValue;
	export let newItemValue = null
	
	function add () {
		if (!currentValue) {
			currentValue = [];
		}
		currentValue = [...currentValue, newItemValue];
		newItemValue = null;
		dispatch('change', currentValue);
	}
	function set (id, newValue) {
		currentValue[id] = newValue;
		dispatch('change', currentValue);
	}
	function discard (id) {
		currentValue.splice(id, 1);
		currentValue = currentValue;
		dispatch('change', currentValue);
	}
	
	$: currentValue = value;
</script>

<div>
	{#if value}
	{#each value as item, id}
		<span>
			<svelte:component
				this={fieldEditor.component}
				value={item}
				{...fieldEditor.props}
				on:change={e => set(id, e)}
			/>
		</span>
		<button on:click={() => discard(id)}>-</button>
	{/each}
	{/if}
	<span>
		<svelte:component
			this={fieldEditor.component}
			value={newItemValue}
			{...fieldEditor.props}
			on:change={e => {
				newItemValue = e.detail;
			}} />
	</span>
	<button on:click={add}>+</button>

</div>

<style>
	div{
		display: grid;
		grid-template-columns: 1fr min-content;
	}
	span {
		display: inline-block;
		position: relative;
	}
	button {
		width: 14px;
	}
</style>