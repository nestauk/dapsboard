<script>
	import {createEventDispatcher} from 'svelte';

	import FieldCount from './FieldCount.svelte';

	const dispatch = createEventDispatcher();

	export let fieldCounts = [];
	let selectedFieldName;

	function selectField (fieldName) {
		selectedFieldName = fieldName;
		dispatch('fieldSelected', fieldName);
	}

	function updateSelection (counts) {
		const exists = counts.some(item => item.name === selectedFieldName);
		if (!selectedFieldName || !exists) {
			if (fieldCounts.length > 0) {
				return fieldCounts[0].name;
			}
			return null;
		}
		return selectedFieldName;
	}

	$: selectField(updateSelection(fieldCounts));
</script>

{#each fieldCounts as field}
	<div
		on:click={() => selectField(field.name)}
		class:selected={field.name === selectedFieldName}
	>
		<FieldCount
			fieldName={field.name}
			count={field.count}
		/>
	</div>
{/each}

<style>
	div {
		background: white;
		border-radius: 3px;
		border: 1px solid #0DA8ED;
		font-size: medium;
		margin: .25em;
		padding: .5em;
	}

	.selected {
		background: blue;
		color: white;
	}
</style>
