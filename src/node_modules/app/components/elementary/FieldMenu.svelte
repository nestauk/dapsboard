<script>
	import {createEventDispatcher} from 'svelte';

	import FieldCount from './FieldCount.svelte';

	const dispatch = createEventDispatcher();

	export let fieldCounts = [];
	let computedSelection;
	let selectedFieldName;

	function emitSelected (fieldName) {
		computedSelection = fieldName;
		dispatch('fieldSelected', fieldName);
	}

	function selectField (fieldName) {
		selectedFieldName = fieldName;
		emitSelected (fieldName);
	}

	function updateSelection (counts) {
		const exists = counts.some(item => item.name === selectedFieldName);
		if (!selectedFieldName || !exists) {
			if (fieldCounts.length > 0) {
				return fieldCounts[0].name;
			}
			return null;
		}
		return selectedFieldName;
	}

	$: emitSelected(updateSelection(fieldCounts));
</script>

{#each fieldCounts as field}
	{#if field.count > 0 || field.name === computedSelection}
		<div
			on:click={() => selectField(field.name)}
			class:selected={field.name === computedSelection}
		>
			<FieldCount
				fieldName={field.name}
				count={field.count}
			/>
		</div>
	{/if}
{/each}

<style>
	div {
		background: white;
		border-radius: 3px;
		border: 1px solid #0DA8ED;
		font-size: medium;
		margin: 0 .75em;
		padding: .5em;
	}

	.selected {
		background: blue;
		color: white;
	}
</style>
