<script>
	// eslint-disable-next-line node/no-unpublished-import
	import { createEventDispatcher } from 'svelte';
	import SimpleField from './SimpleField.svelte';
	
	const dispatch = createEventDispatcher();

	export let id = null;
	export let dataType = 'null';
	export let required = false;
	export let value = null;
	export let defaultValue = null;
	
	let type;
	let min;
	let max;
	let defaultMin;
	let defaultMax;
	let notEmpty = false;
	let complete = false;

	function handleValueChange (newValue) {
		if (newValue) {
			min = newValue.min;
			max = newValue.max;
			notEmpty = Boolean(min || max);
			complete = Boolean(min && max);
		} else {
			min = null;
			max = null;
			notEmpty = false;
			complete = false;		
		}
		console.log('value changed', min, max, notEmpty, complete);
	}
	function handleEditorChange (newValue) {
		let payload = null;
		if (complete) {
			payload = newValue;
		}
		dispatch('change', payload);
	}
	function handleChangeMin (event) {
		const newValue = {min: event.detail, max};
		handleValueChange(newValue);
		handleEditorChange(newValue);
	}
	function handleChangeMax (event) {
		const newValue = {min, max: event.detail};
		handleValueChange(newValue);
		handleEditorChange(newValue);
	}

	function handleFocus () {
		dispatch('focus');
	}
	function handleBlur () {
		dispatch('blur');
	}

	const types = {
		'integer': 'number',
		'float': 'number',
		'string': 'text',
	};
	
	$: type = types[dataType];
	$: handleValueChange(value);
	$: defaultValue && (
		defaultMin = defaultValue.min,
		defaultMax = defaultValue.max
	) || !defaultValue && (
		defaultMin = undefined,
		defaultMax = undefined
	);
</script>

<label for={id + '-min'}>Min</label>
<SimpleField
	id={id + '-min'}
	{type} 
	{dataType}
	value={min}
	defaultValue={defaultMin}
	on:change={handleChangeMin}
	on:focus={handleFocus}
	on:blur={handleBlur}
	required={required || notEmpty}
/>
<label for={id + '-max'}>Max</label>
<SimpleField
	id={id + '-max'}
	{type} 
	{dataType}
	value={max}
	defaultValue={defaultMax}
	on:change={handleChangeMax}
	on:focus={handleFocus}
	on:blur={handleBlur}
	required={required || notEmpty}
/>