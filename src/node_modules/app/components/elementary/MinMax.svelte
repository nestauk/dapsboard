<script>
	// eslint-disable-next-line node/no-unpublished-import
	import { createEventDispatcher } from 'svelte';
	import SimpleField from './SimpleField.svelte';
	
	const dispatch = createEventDispatcher();

	export let id = null;
	export let dataType = 'null';
	export let required = false;
	export let value = null;
	export let defaultValue = null;
	
	let type;
	// let isDefaultValueMin = false;
	
	function handleChange (newValue) {
		let payload = newValue;
		if (!payload.min && !payload.max) {
			payload = null;
		}
		dispatch('change', payload);
	}
	function handleChangeMin (event) {
		handleChange({...value, min: event.detail});
	}
	function handleChangeMax (event) {
		handleChange({...value, max: event.detail});
	}

	function handleFocus () {
		dispatch('focus');
	}
	function handleBlur () {
		dispatch('blur');
	}

	const types = {
		'integer': 'number',
		'float': 'number',
		'string': 'text',
	};
	
	$: type = types[dataType];

	/*
	const testType = `{
	min: Opaque<number, "float">;
	max: Opaque<number, "float">;
}`;
	const cleanup = str => str.replace(/\s+/g, ' ')
	const result = cleanup(testType)
	*/
</script>

<label for={`${id}-min`}>Min</label>
<SimpleField
	id={`${id}-min`}
	{type} 
	{dataType}
	value={value && value.min}
	defaultValue={defaultValue && defaultValue.min}
	on:change={handleChangeMin}
	on:focus={handleFocus}
	on:blur={handleBlur}
	required={required}
/>
<label for={`${id}-max`}>Max</label>
<SimpleField
	id={`${id}-max`}
	{type} 
	{dataType}
	value={value && value.max}
	defaultValue={defaultValue && defaultValue.max}
	on:change={handleChangeMax}
	on:focus={handleFocus}
	on:blur={handleBlur}
	required={required}
/>