<script>
	// eslint-disable-next-line node/no-unpublished-import
	import { createEventDispatcher } from 'svelte';
	import { autoID } from 'app/utils';

	const dispatch = createEventDispatcher();

	const id = autoID();

	export let labelText = '';
	export let dataType = 'text';
	export let value;

	let type;

	const inputTypes = {
		date: 'date',
		'Opaque<string, "Date_YYYYMMDD_dash">': 'date',
		'Opaque<string, "Date_YYYYMMDD_dash_time">': 'date',
		'Opaque<string, "ES_keyword">': 'text',
		'Opaque<string, "ES_text">': 'text',
		'Opaque<string, "ES_text_w_keyword">': 'text',
		'Opaque<number, "integer">': 'number',
		'Opaque<number, "float">': 'number',
		string: 'text'
	}

	const typeFormatters = {
		'Opaque<number, "integer">': v => v.length > 0 ? Number.parseInt(v, 10) : null,
		'Opaque<number, "float">': v => v.length > 0 ? Number.parseFloat(v) : null,
	}

	function computeInputType (esType) {
		console.log(inputTypes[esType]);
		return inputTypes[esType];
	}

	function handleInputChange (event) {
		let fieldValue = event.target.value;
		if (dataType in typeFormatters) {
			fieldValue = typeFormatters[dataType](fieldValue);
		}
		dispatch('change', fieldValue);
	}

	$: type = computeInputType(dataType);
</script>

<label for={id}>{labelText}</label>
<input {id} {type} {value} on:change={handleInputChange}>

<style>
label {
	display:block;
}
</style>