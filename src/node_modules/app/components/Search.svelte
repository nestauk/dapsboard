<script>
	import {createEventDispatcher} from 'svelte';
	import {autoID} from 'utils/generic';

	const dispatch = createEventDispatcher();

	let id = autoID();
	let value;
	let textInput;
	let searchButton;

	export function focus () {
		textInput.focus();
	}

	function handleKeyDown (event) {
		switch (event.keyCode) {
			case 40:
				dispatch('downArrow');
				event.preventDefault();
				break;
			case 38:
				dispatch('upArrow');
				event.preventDefault();
				break;
			default:
		}
	}

	function emitFocusEvent () {
		dispatch('focus');
	}

	function emitBlurEvent () {
		dispatch('blur');
	}

	function emitSearchEvent () {
		dispatch('search', value);
		searchButton.focus();
	}

	function emitEditEvent (newValue) {
		dispatch('edit', newValue);
	}

	$: emitEditEvent(value);
</script>

<div>
	<input
		bind:this={textInput}
		{id}
		type='text' 
		bind:value 
		on:change={emitSearchEvent}
		on:keydown={handleKeyDown}
		on:focus={emitFocusEvent}
		on:blur={emitBlurEvent}
		autocomplete='off'
	>
	<button
		bind:this={searchButton}
		class='clickable'
		on:click={emitSearchEvent}
	>Search</button>
</div>

<style>
	div {
		display: grid;
		grid-template-columns: 1fr min-content;
		margin: .75em;
	}

	input, button {
		background: white;
		border-radius: 3px;
		border: 1px solid #0DA8ED;
		font-size: medium;
		margin: .25em;
		padding: .5em;
	}

	button {
		color: #3EBEF6;
		font-weight: bold;
		padding: .5em 1em;
	}
</style>
