import * as _ from 'lamb';
import {getId, isFunction} from '@svizzle/utils';

export const indexById = _.indexBy(getId);

export const IS_BROWSER = process.browser;

let lastId = 0;
export function autoID () {
	return `${IS_BROWSER ? 'client' : 'server'}${lastId++}`;
}

// TODO -> evaluateIfFunction
export const evaluate = type => _.when(isFunction, _.applyTo([type]));

export const ifExistsGet = prop => _.casus(_.hasKey(prop), _.getKey(prop));

export const isKeyOf = obj => key => key in obj;
export const getKeyOf = obj => key => obj[key];

export const descentReducer = (hasChildren, getChildren) => {
	const reducer = _.curryable((reducerFn, init, node) => {
		const acc = reducerFn(init, node);
		if (!hasChildren(node)) {
			return acc;
		}
		return getChildren(node).reduce(reducer(reducerFn), acc);
	});
	return reducer;
}
