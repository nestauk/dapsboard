import * as _ from 'lamb';
import {
	makeIsIncluded,
	makeMergeAppliedFnMap,
	valuesWith,
} from '@svizzle/utils';
import {
	typeKey,
	shapeKey,
	defaultKey,
	isAppDefaultKey
} from 'app/elasticsearch/types/genericTypes';
import {optionalKey} from 'app/elasticsearch/types/esTypes/params';

import {is_required} from 'app/elasticsearch/types/esTypes/params.utils';

const getParamInfo = valuesWith(
	(paramType, paramId) => ({
		paramId,
		type: paramType,
		required: is_required(paramType),
		displayText: JSON.stringify(paramType, null, 2)
	})
);

export const getParamsInfo = _.pipe([
	getParamInfo,
	_.filterWith(_.not(_.pipe([
		_.getKey('paramId'),
		makeIsIncluded([typeKey, shapeKey, optionalKey, defaultKey, isAppDefaultKey])
	]))),
	_.sortWith([_.not(_.getKey('required'))])
]);

export const mergeDocs = (partialParamsInfo, docs) =>
	partialParamsInfo.map(makeMergeAppliedFnMap({
		documentation: param => docs[param.paramId]
	}));
