// eslint-disable-next-line node/no-unpublished-import
import { get } from 'svelte/store';
// eslint-disable-next-line node/no-unpublished-import
import { spawn } from 'xstate';
// eslint-disable-next-line node/no-extraneous-import
import {capitalise} from 'svizzle/utils/string-string';

import { createFormMachine } from './form';

const AXIS_NAMES = [
	'primary',
	'secondary',
	'tertiary',
	'quaternary',
	'quinary',
	'senary',
	'septenary',
	'octonary',
	'nonary',
	'denary'
];

export function spawnNestedForm (ctx) {
	const forms = get(ctx.forms);
	const nextName = AXIS_NAMES[forms.length];
	const {machine: formTemplate} = createFormMachine({
		...ctx,
		selection: {
			aggregation: null,
			type: null,
			field: null,
		},
		params: {},
		query: {},
		id: nextName
	});
	const spawned = spawn(formTemplate, nextName);
	ctx.forms.set([
		...forms,
		{
			name: nextName,
			text: capitalise(nextName),
			value: forms.length,
			disabled: false,
			machine: spawned
		}
	]);
}
